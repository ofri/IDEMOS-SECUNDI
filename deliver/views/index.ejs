<!DOCTYPE html>

<html>
<head>
    <% include partials/head.ejs %>


    <style>

        .main-video {

            height: 306px;
            padding-top: 43px;
            clear: both;

            color: #fff;
            font: normal 25px/30px 'AdumaFOTRegular';
        }

        .main-video .video-box {
            float: right;
            margin-left: 58px;
            position: relative;
            height: 267px;
        }

        .main-video .video-box span {
            position: absolute;
            left: 50%;
            top: 50%;
            width: 72px;
            height: 72px;
            background: url(../images/play-btn.png) no-repeat;
            margin: -36px 0 0 -36px;
        }

        .main-video .side-text {
            color: #fff;
            height: 89px;
            margin-bottom: 35px;
        }

        .main-video .side-button {
            font-size: 30px;
            display: inline-block;
            position: relative;
            margin-right: -11px; /* To account for transparent bit inside the actual image */
            float: right;
            height: 125px;
        }

        .main-video .after-button {
            display: inline-block;
            width: 190px;
            margin-top: 45px;
        }


        .big-head {
            background: #ededed url(../images/header-bg-big.png) 0 0 repeat-x;
        }
        .big-head .search-box {
            margin-top: 16px;
        }

        .main-video .side-title {

            font: normal 35px/35px 'AdumaFOTRegular';
            margin-bottom: 15px;
        }


         #cycle a.iconbutton {
            position: absolute;
             left: 70px;
             top: 368px;



        }



        .main-video input{

            -moz-box-shadow: inset 3px 2px 5px #a7a7a7;
            -webkit-box-shadow: inset 3px 2px 5px #a7a7a7;
            box-shadow: inset 3px 2px 5px #a7a7a7;
            border: none;
            -moz-border-radius: 5px;
            border-radius: 5px;
            -webkit-border-radius: 5px;
            height: 30px;
            width: 145px;

            color: #4f4f4e;
            margin-right: 7px;;
            padding: 0 5px;
        }

        a.fbbutton {
            position: absolute;
            margin: 10px 137px 0 0;
            font-size: 20px;
            line-height: 35px;
            background: transparent url('images/fb_btn2.png') no-repeat scroll 0  0;
            color: #FFF;
            display: inline-block;
            float: left;
            font: normal 20px 'AdumaFOTRegular';
            height: 42px;
            padding-left: 50px; /* sliding doors padding */
            text-decoration: none;
        }

         a.fbbutton:hover {
            background-position: 0 -42px ;
            outline: none; /* hide dotted outline in Firefox */
        }

         a.fbbutton:active {
            background-position:  0 -84px;
            outline: none; /* hide dotted outline in Firefox */
        }


         a.fbbutton  span.button_inner {
            background: transparent url('images/fb_btn1.png') right 0  no-repeat;
            height:27px;
            display: block;

            padding: 10px 15px 5px 10px;
            text-align: center;

            color: #fff;

            /*text-shadow: #686868 right -1px 0;*/
            min-width: 75px;
            line-height: 28px;

             font: normal 20px 'AdumaFOTRegular';

        }

         a.fbbutton:hover span.button_inner {
            background-position: right -42px ;

        }

         a.fbbutton:active  span.button_inner {
            background-position:right -84px;
            outline: none; /* hide dotted outline in Firefox */
        }
         .err{
             display: none;
             font-size:12px;
             position: absolute;
             color: yellow ;
         }
         #email_err{

             right: 635px;
             top: 348px;

         }
        #name_err{

            right: 465px;
            top: 348px;

        }
        #fb_err{

            right: 465px;
            top: 455px;

        }
        #pass{
            display: none;
        }


    </style>
</head>
<body <%= user_logged? '' : 'class=big-head' %> >
<% include partials/body_top.ejs %>
<div id="wrap">
    <div id="header">
        <% include partials/menu.ejs %>
        <% include partials/user_box.ejs %>
        <% include partials/failures.ejs %>
        <%if(!user_logged){%>
        <div class="main-video" id="cycle">
            <div class="video-box">
                <img class="video_img"   src="images/voting.jpg" alt=""/>
            </div>
            <div class="err" id="email_err">email</div>
            <div class="err"  id="name_err">name</div>
            <div class="err"  id="fb_err">fb</div>
            <p class="side-title">
                "שרינו על כתפינו":

                בממשלה הבאה 18 שרים
            </p>
            <p class="side-text">

                36 שרים וסגני שרים  הפכו את הממשלה היוצאת למסורבלת ובלתי יעילה וגרמו לבזבוז של כספי ציבור. לקראת הקמת הממשלה הבאה אנחנו יוצאים בדרישה לראשי המפלגות הגדולות - אל תיתנו יד לעוד ממשלה מנופחת ובזבזנית!
            <a href="cycles/508026e8cb2276020000001f" style="font-size: 20px;padding-right: 10px;color:#fff">
קראו עוד
            </a>
            </p>
               <br>
            חתמו על העצומה
            <input type="text" id="name"  placeholder="שם">
            <input type="text" id="email" placeholder="אימייל">
            <input type="text" id="pass" placeholder="סיסמה">
            <a  class="iconbutton" href="javascript:void(0)"  ><span class="button_inner"><span >
שליחה
</span></span></a>
            <br>
            <div style="margin-top: 20px;display: inline-block">
                או
            </div>
            <a  class="fbbutton"  href="/account/facebooklogin?next=cycles/508026e8cb2276020000001f?join=true"  >
	<span class="button_inner">

חתמו באמצעות פייסבוק

	</span>
            </a>




        </div>
        <%}%>
        <% include partials/tag_search.ejs %>
    </div>
    <div id="content" class="cf">
        <div class="right-col">
            <h2>עוררו עניין</h2>

            <div class="news-list cf">
            </div>
            <%if(user_logged){%>
            <h2>עדכונים</h2>

            <div class="renewal">

            </div>
            <%}%>
            <h2 class="hide">סיפורי הצלחה</h2>

            <div class="succes-box cf hide">

            </div>
        </div>
        <div class="left-col">
            <h2>מה בכותרות</h2>

            <div class="one-news">

            </div>
            <!-- <h2>מה מפריע לך?</h2>
            <form  class="comment-form" action="#" >
                <textarea placeholder="כתוב לנו מה מפריע לך ..." name="feedbackTb" cols="0" rows="0"></textarea>
                <input type="image" src="images/send-btn.png" />
            </form>-->
            <div class="fb_like_box">
                <div class="fb-like-box" data-href="http://www.facebook.com/URUisrael" data-width="308" data-height="560" data-show-faces="true" data-stream="true" data-header="false" data-border-color="white" ></div>
            </div>
        </div>
        <div class="blog-box">
            <h2>מאמרים מובילים</h2>
        </div>
    </div>
</div>
<% include partials/footer.ejs %>
</body>
</html>

<script type="text/javascript">
    var current_section;
    $(function () {

        var user_logged = "<%= user_logged %>" == 'true';

        $(".iconbutton").click( function(){
            $("#email_err").hide();
            $("#name_err").hide();
            $("#fb_err").hide();
            var email =$('#email').val();
            var name =$('#name').val();
            var pass =$('#pass').val();
            if(validateEmail(email))
            {
                db_functions.getUserbyEmail(email,function(err,data){
                    var registered_fb=false;
                    var registered_normal=false;
                    $.each(data.objects, function(index, user) {
                        if (user.identity_provider=="register") {
                            registered_normal=true;
                        }
                        if (user.identity_provider=="facebook") {
                            registered_fb=true;
                        }
                    });
                    if(registered_fb)  {
                        $("#fb_err").text("הנכם רשומים בעורו באמצעות פייסבוק אנא חתמו באמצעות כפתור זה").show();
                    } else if(registered_normal) {
                        if (pass==''){
                            $("#email_err").text("הנכם משתמשים רשומים בעורו, אנא הקישו סיסמא לחתימה").show();
                            $("#pass").show();
                            $(".iconbutton").css('left','-100px');
                        } else {
                            db_functions.login(email,pass, function(err, result){
                                if(err){
                                    $("#email_err").text("מייל וססמה לא תואמים, נא נסה שנית").show();
                                }
                                else{
                                    window.location.href = '/cycles/508026e8cb2276020000001f?join=true'    ;
                                }
                            });
                        }
                    } else{
                        db_functions.register(name , email,  '508026e8cb2276020000001f' ,function(err,data){
                                window.location.href = '/cycles/508026e8cb2276020000001f'    ;
                        })  ;
                    }

                });
            }else{
               $("#email_err").text("נא להקיש מייל חוקי").show();
            }
        });

        function validateEmail(email) {
            var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            return re.test(email);
        }
            /*
            db_functions.register( $('#name').val() ,  $('#email').val(),  '508026e8cb2276020000001f' ,function(err,data){
                  if (data.responseText== "סיסמא שגויה") {
                      dust.render('enter_password', null, function (err, out) {
                          $.colorbox({
                                  html:out,
                              onComplete:function (e) {

                              },
                              onClosed:function(){

                              }
                          });
                      });
                    // $("#login_button a").click();
                  }  else
                  {
                      window.location.href = '/cycles/508026e8cb2276020000001f'    ;
                  }
            })  ;     */


        window.vars={};
        window.vars.afterLogin  =  function () {
            window.location.href = '/cycles/508026e8cb2276020000001f?join=true'    ;
        }




        $(".video-box").one('click', function(){
            window.location.href = '/cycles/508026e8cb2276020000001f'    ;
            /*
             $('.video_img').remove();
             $(this).append(
             '<object width="560" height="315">' +
             '<param name="movie" value="http://www.youtube.com/v/6LYw5crRh8E?version=3&autoplay=1&amp;hl=en_US&amp;rel=0" />' +
             '<param name="allowFullScreen" value="true" /><param name="allowscriptaccess" value="always" />' +
             '<embed src="http://www.youtube.com/v/6LYw5crRh8E?version=3&autoplay=1&amp;hl=en_US&amp;rel=0" type="application/x-shockwave-flash" width="416" height="267" allowscriptaccess="always" allowfullscreen="true"></embed>' +
             '</object>');
             */
        });

        $('form.comment-form').live('submit', function (e) {
            e.preventDefault();
            var feedbackTb = this['feedbackTb'];
            if (feedbackTb.value.replace(/\s/g, "") == "") {
                return;
            }
            db_functions.addKilkul(this['feedbackTb'].value, function (error, data) {
                if (error) {
                    console.log(error);
                } else {
                    feedbackTb.value = '';
                }
            });

        });

        db_functions.getHotObjects(function (data) {
            $.each(data.objects, function (key, article) {
                dust.render('hot_object', article, function (err, html) {
                    $('div.news-list').append(html);
                })
            })
        });

        db_functions.getSuccessStories(function (data) {
            $.each(data.objects, function (key, article) {
                dust.render('success_story', article, function (err, html) {
                    $('div.succes-box').append(html);
                })
            })
        });

        db_functions.getPopularArticles(3, function (data) {
            $.each(data.objects, function (index, article) {
                article.is_last = index == data.objects.length - 1;
                dust.render('article', article, function (err, html) {
                    $('div.blog-box').append(html);
                });
            });
        });


        db_functions.getPopularHeadlines(3, function (data) {
            $.each(data.objects, function (index, headline) {
                dust.render('headline', headline, function (err, html) {
                    $('div.one-news').append(html);
                })
            })
        });

        if(user_logged) {

            db_functions.getNotifications(null, 5, function (data) {
                dust.renderArray('notification', data.objects, null,function (err, html) {
                    $('.renewal').append(html).append('<a href="/myuru">' +
                            '                        קרא עוד...' +
                            '</a>');

                });
            });
            current_section = 0;
        }
    })


</script>