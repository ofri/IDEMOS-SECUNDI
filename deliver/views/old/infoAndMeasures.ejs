<script type="text/javascript">
    $(function() {

        var tag_name = "<%= tag_name %>";

        var items = {
            add: function(data, parent) {
                var item =
                        $('<div class="item">' +
                                '<h2>' + data.title + '</h2>' +
                                '<p>' + data.text_field +'</p>' +
                                '<button class="add" value="' + data._id + '">add to your shopping cart</button>' +
                                '<button class="remove hide" value="' + data._id + '">remove from your shopping cart</button>' +
                                '</div>')

                                .appendTo('.' + parent);

                item.find('button.add').click(function() {
                    self = $(this)
                    db_functions.dbAddInfoItemToShoppingCart($(this).val(), function didSucceed(flag){
                        console.log(flag);
                        if(flag){
                            var item = self.parent('.item').clone().appendTo('.shopping_cart');
                            items.changeButton(item);
                            ////////////////////////////////////////////////////////////////////////////////////////
                            item.find('button.remove').click(function() {
                                console.log("In remove");
                                db_functions.dbDeleteInfoItemFromShoppingCart(data._id);
                                $(this).parent('.item').remove();
                            });
                            ////////////////////////////////////////////////////////////////////////////////////////
                        }else{
                            console.log('information item is already in shopping cart');
                        }
                    });
                });

                item.find('button.remove').click(function() {
                    console.log("In remove");
                    db_functions.dbDeleteInfoItemFromShoppingCart(data._id);
                    $(this).parent('.item').remove();
                });

                return item;
            },
            changeButton: function(item) {
                item.find('button').toggle();
            },
            remove: false
        };

        var COUNTER = 0;


            if( tag_name == 'חיפוש עפ TAGS')
                tag_name = '';

            $('#search_form').submit(function()
            {
                $('#btn_look').click();
                return false;
            });

            $('#search_results').hide();
            if(tag_name != undefined && tag_name != "undefined" && tag_name != null){
                $('#search_results').show();
                $("#look_for_tags").attr('value', tag_name);
            }


            $('#btn_look').live("click", function(){
                $('#search_results').show();
                $('.tags').html('');
                var tag_value = $("#look_for_tags").val();
                tag_name = tag_value;
                $('#search-content .slider').hide().removeAttr('fetched');
                $('#results_info_items').show();

                click_list_type('information_items');

                event.stopPropagation();
            });

            $('#more_hot_items_btn').live("click", function(){
                COUNTER++;
                console.log(COUNTER);
                //bring me page naumer counter
            });

            function click_list_type(type)
            {
                var results_div = $('#results_' + type);
                $('#search-content .slider:visible').hide();
                results_div.show();
                $('.search-list li.active').removeClass('active');
                $($('a[li-value=' + type +']').parent()).addClass('active');
                if(!results_div.is('[fetched]'))
                {
                    $('ul',results_div).empty();
                    db_functions.getItemsByTagNameAndType(type,tag_name,function(err,data)
                    {
                        dust.renderArray(type, data.objects,null,function(err,out){
                            $('ul',results_div).append(out);
                            $('img',results_div).autoscale();
                            results_div.show().attr('fetched','');
                        });
                    });
                }
            }

            $('#search-content .search-type').click(function(type)
            {
                var a = $(this);
                var type = a.attr('li-value');
                click_list_type(type);
            });

            if($('#search_results:visible').length)
                click_list_type('information_items');
    });
</script>

<div id="main">
    <div class="post clearfix">
        <h2><%=big_impressive_title%></h2>
<div class="search-area">
    <div id="search-form" class="form">
        <form action="" id='search_form' method="post">
            <p class="clearfix">
                <input type="text" title="search" class="textbox" id="look_for_tags" />
                <input type="button" id="btn_look" title="submit" class="submit-btn" value="חפש"/>
            </p>
        </form>
    </div>


    <div id="search_results">

        <h3>תוצאות חיפוש (13):</h3>
        <div class="search-content" id="search-content">
            <ul class="search-list clearfix">
                <li class="active"> <a href="javascript:void(0)"  class="search-type" li-value="information_items"> <span class="circle"></span> מידע ומדדים </a> </li>
                <li> <a href="javascript:void(0)" class="search-type" li-value="cycles"> <span class="circle"></span>מעגלי תנופה</a> </li>
                <li> <a href="javascript:void(0)" class="search-type" li-value="discussions"> <span class="circle"></span>דיונים</a> </li>
                <li> <a href="javascript:void(0)" class="search-type" li-value="actions"> <span class="circle"></span>פעולות</a> </li>
                <li> <a href="javascript:void(0)" class="search-type" li-value="blogs"> <span class="circle"></span>בלוגים</a> </li>
            </ul>

            <div id="results_information_items" class="slider clearfix">
                <div>
                <ul id="information_items_list" class="clearfix"> </ul>
                </div>
                <div class="controls"><a href="javascript:void(0)" class="left-btn"></a></div>
            </div>

            <div id="results_cycles" class="slider clearfix" style="display:none;">
                <div>
                <ul id="cycle_list" class="clearfix"> </ul>
                </div>
                <div class="controls"><a href="javascript:void(0)" class="left-btn"></a></div>
            </div>

            <div id="results_discussions" class="slider clearfix" style="display:none;">
                <div>
                <ul id="discussion_list" class="clearfix"> </ul>
                </div>
                <div class="controls"><a href="javascript:void(0)" class="left-btn"></a></div>
            </div>

            <div id="results_actions" class="slider clearfix" style="display:none;">
                <div>
                <ul id="action_list" class="clearfix"> </ul>
                </div>
                <div class="controls"><a href="javascript:void(0)" class="left-btn"></a></div>
            </div>
            <div id="blogs_actions" class="slider clearfix" style="display:none;">
                <div>
                <ul id="blogs_list" class="clearfix"> </ul>
                </div>
                <div class="controls"><a href="javascript:void(0)" class="left-btn"></a></div>
            </div>
        </div>
    </div>
</div>

<h4 class="flR">בחירה מתוך 7 תחומי על</h4>


<br class="clear" />
<ul id="subjects_list" class="list2 clearfix"></ul>

<h2>הנושאים הבוערים</h2>
<div class="topics">
    <ul id="hot_items_list" class="list2 clearfix"></ul>

    <button id="more_hot_items_btn" class="button1">עוד נושאים בוערים**</button>
    <!--<a href="javascript:void(0)" class="button1">עוד נושאים בוערים**</a>-->
</div>
</div>
</div>


