<!DOCTYPE html>
<html>
<head>
    <title>משחק הבחירות</title>
    <!-- Bootstrap -->

    <% include partials/head.ejs %>
    <style>
    body{
        margin: 0;
        font-family:arial;
        background-color: #4d4d4d;
    }

    #wrapper{
        width:100%;
        padding:0;
        margin:auto;
    }

    #header_wrapper{
        width:940px;
        padding:0 20px;
        margin:auto;
        height:215px;
        background:url(images/bg_top.png) top center no-repeat;
        z-index: 1;
        position:relative;
    }

    #header_top{
        width:100%;
        padding-top:10px;
        height:120px;
    }

    #header_bottom{
        width:100%;
        height:70px;

    }

    #logo_holder{
        width:150px;
        float:right;
        height:86px;
        padding-top:10px;
        text-align:right;
    }

    #title_holder{
        float:right;
        width:640px;
        height:120px;
        line-height:120px;
        margin:auto;
        text-align:center;
    }

    #logo_holder img,
    #title_holder img{
        vertical-align:middle;
    }

    #social_holder{
        float:right;
        width:150px;
    }

    #social_holder .social_item{
        margin:10px 0;
        text-align: left;
    }

    #participants_holder{
        width:810px;
        float:right;
    }

    #participants_total{
        font-size:23px;
        max-width:220px;
        float:right;
        color:#9b9a9a;
        line-height:70px;
    }

    #participants_thumbs{
        max-width:610px;
        float:right;
        border-left: 1px solid #d5d5d5;
        padding: 0px 15px;
        margin: 14px 0;
        padding: 16px 7px 0 7px;
        margin: 4px 0;
    }

    .participant_thumb{
        float:right;
        height:32px;
        width:32px;
        background:url(images/participant_thumb.png) 0 0 no-repeat;
        margin: 0 4px;
    }

    #login{
        position: relative;
        margin-top: -32px;
        float:left;
        width:130px;
    }

    #login input{
        border:0px;
        background:url(images/sprite.png) -1px -119px no-repeat;
        margin:16px 0;
        width:118px;
        height:40px;
        float:left;
        cursor:pointer;
    }

    #content_wrapper{
        direction:rtl;
        margin-top: -14px;
        z-index: 0;
        float: right;
        width: 100%;
        background: url(images/bg_content.jpg) no-repeat center center fixed;
        -webkit-background-size: cover;
        -moz-background-size: cover;
        -o-background-size: cover;
        background-size: cover;
    }

    #how_to_play{
        position:relative;
        margin:auto;
        width:670px;
        padding:15px 50px;
        font-size:16px;
        color:#7c7763;
        background:#f8f3de;
        -moz-border-radius-topleft: 0px;
        -moz-border-radius-topright:0px;
        -moz-border-radius-bottomleft:10px;
        -moz-border-radius-bottomright:10px;
        -webkit-border-top-left-radius:0px;
        -webkit-border-top-right-radius:0px;
        -webkit-border-bottom-left-radius:10px;
        -webkit-border-bottom-right-radius:10px;
        border-top-left-radius:0px;
        border-top-right-radius:0px;
        border-bottom-left-radius:10px;
        border-bottom-right-radius:10px;
        -moz-box-shadow: 0px 2px 5px #000000;
        -webkit-box-shadow: 0px 2px 5px #000000;
        box-shadow: 0px 2px 5px #000000;
    }

    #how_to_play h2{
        color:#7c7763;
        margin:0 3px;
        font-size:16px;
        font-weight:bold;
    }

    #close_button{
        position:absolute;
        bottom:-15px;
        left:-15px;
        background:url(images/sprite.png) -108px -13px no-repeat;
        height:28px;
        width:28px;
        cursor:pointer;
    }

    #quotes_holder{
        width:820px;
        margin:15px auto 0px auto;
        padding:15px 50px 0 50px;
    }

    #quotes_counter{
        float:right;
        color:#afbcf7;
        font-style:italic;
    }
    #goto_results{
        display: none;
        float: left;
    }
    #goto_results a{

        color:#afbcf7;
        font-style:italic;
    }

    #current_quote_holder{
        position:relative;
        display: none;
        border: 5px solid #fff;
        background:#fff url(images/bg_quote.jpg) bottom center repeat-x;
        margin:30px auto;
        padding:15px 40px;
    }

    blockquote{
        font-size: 40px;
        font-family: david;
        color: #4A4A4B;
        display: block;
        width: 90%;
        height: auto;
        margin: 0px;
        padding: 30px 40px 30px 20px;
        position: relative;
        line-height: 48px;
    }

    .quote_start{
        width:32px;
        height:23px;
        background:url(images/sprite.png) -50px -13px no-repeat;
        display:block;
        position:absolute;
        top:0px;
        right:5px;
    }

    .quote_end{
        width:32px;
        height:23px;
        background:url(images/sprite.png) -10px -14px no-repeat;
        display:block;
        position:absolute;
        bottom:0px;
        left:0px;
    }

    .quote_credit{
        font-family:david;
        font-size:23px;
        font-weight:bold;
        color:#3b63ef;
        float:right;
        width: 100%;
    }

    .quote_credit a{
        text-decoration:none;
        font-family:david;
        font-size:23px;
        font-weight:bold;
        color:#3b63ef;
    }

    .quote_credit a:hover{
        text-decoration:underline;
    }

    .quote_party{
        font-family:david;
        font-size:23px;
        font-weight:normal;
        color:#3b63ef;
    }

    #current_quote_photo{
        position: absolute;
        top: 38%;
        left: 710px;
        border:3px solid #fff;
        height: 118px;
        overflow:hidden;
        height:118px;
        width: 82px;
    }

    #current_quote_photo img{
        vertical-align:middle;
        position: absolute;
        height:118px;
        -moz-box-shadow: 0px 1px 3px #8e8d8d;
        -webkit-box-shadow: 0px 1px 3px #8e8d8d;
        box-shadow: 0px 1px 3px #8e8d8d;
    }

    #poll_holder{
        width: 780px;
        margin: 0px auto 15px auto;

        position: relative;
        top: 35px;
    }

    .poll_option{
        border:0px;
        margin:0px auto;
        cursor:pointer;
        float:right;
        padding:0px;
    }

    .poll_option#option_1{ display:block; height:60px; width:166px; background:url(images/sprite.png) -614px -220px no-repeat; }
    .poll_option#option_1:hover{ background-position:-614px -293px; }
    .poll_option#option_1:active{ background-position:-614px -373px; }

    .poll_option#option_2{ display:block; height:60px; width:149px; background:url(images/sprite.png) -465px -220px no-repeat; }
    .poll_option#option_2:hover{ background-position:-465px -293px; }
    .poll_option#option_2:active{ background-position:-465px -373px; }

    .poll_option#option_3{ display:block; height:60px; width:160px; background:url(images/sprite.png) -305px -220px no-repeat; }
    .poll_option#option_3:hover{ background-position:-305px -293px; }
    .poll_option#option_3:active{ background-position:-305px -373px; }

    .poll_option#option_4{ display:block; height:60px; width:150px; background:url(images/sprite.png) -155px -220px no-repeat; }
    .poll_option#option_4:hover{ background-position:-155px -293px; }
    .poll_option#option_4:active{ background-position:-155px -373px; }

    .poll_option#option_0{ display:block; height:60px; width:155px; background:url(images/sprite.png) 0px -220px no-repeat; }
    .poll_option#option_0:hover{ background-position:-0px -293px; }
    .poll_option#option_0:active{ background-position:-0px -373px; }

    #other_buttons_holder{
        width: 780px;
        margin: 15px auto;
        height: 48px;
        position: relative;
        top: 120px;
    }

    #other_buttons_holder input{
        border:0px;
        cursor:pointer;
    }

    .end_game{ float:right; display:block; height:48px; width:275px; margin-right:4px; padding: 0; background:url(images/sprite.png) -502px -463px no-repeat; }
    .end_game:hover{ background-position: -502px -525px; }
    .end_game:active{ background-position: -502px -590px; }

    .to_index{ float:left; display:block; height:48px; width:275px; padding: 0; background:url(images/sprite.png) 0px -460px no-repeat; }
    .to_index:hover{ background-position: -0px -522px; }
    .to_index:active{ background-position: -0px -587px; }

    #footer_wrapper{
        background:url(images/bg_footer.jpg) 0 0 repeat-x;
        direction:rtl;
        width:100%;
        float:right;
        padding:0px;
        height:290px;
    }

    #footer_content{
        padding-top: 20px;

        width:800px;
        border-top:1px solid #5e5e5d;
        margin:135px auto 0px auto;
    }

    #footer_wrapper h3{
        color:#e2e8fc;
        font-size:14px;
        font-weight:bold;
    }

    #footer_wrapper .col{
        float:right;
        width:160px;
        font-size:12px;
        color:#cccccc;
        margin:0 20px;
    }

    #footer_wrapper .col ul{
        padding:0px;
        margin:0px;
    }

    #footer_wrapper .col ul li{
        list-style:none;
        padding:0px;
        margin:0px;
        text-indent:0px;
        font-size:12px;
        color:#cccccc;
    }

    #footer_wrapper .col ul li ul{
        padding-right:10px;
    }

    #footer_wrapper .col ul li ul li{
        list-style:initial;
        margin-right:8px;
    }
    #footer_wrapper .col a{
        text-decoration:none;
        color:#cccccc;
    }

    #footer_wrapper .col a:hover{
        text-decoration:underline;
    }

    #social_icon_row{
        float:right;
        width:100%;
    }

    #preload_img{
        position: absolute;
        top: 0;
        left: 0;
        width: 0;
        height: 0;
    }
    .social_icon{
        float:right;
        width:26px;
        margin:3px 4px;
    }
    </style>


</head>
<body>

<script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/he_IL/all.js#xfbml=1";
    fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div id="wrapper">
    <img src="images/quote_photo.png" id="preload_img"  >
    <div id="header_wrapper">
        <div id="header_top">
            <div id="logo_holder">
                <a href="\">
                    <img src="images/logo.png" />
                </a>
            </div>
            <div id="title_holder">
                <img src="images/title.png" />
            </div>

            <div id="social_holder">
                <div class="social_item fb">
                    <div class="fb-like" data-href="http://developers.facebook.com" data-send="false" data-layout="button_count" data-width="450" data-show-faces="false"></div>
                </div>
                <div class="social_item gp">
                    <!-- Place this tag where you want the +1 button to render. -->
                    <div class="g-plusone"></div>

                    <!-- Place this tag after the last +1 button tag. -->
                    <script type="text/javascript">
                        (function() {
                            var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
                            po.src = 'https://apis.google.com/js/plusone.js';
                            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
                        })();
                    </script>
                </div>
                <div class="social_item tw">
                    <a href="https://twitter.com/share" class="twitter-share-button">Tweet</a>
                    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
                </div>
            </div>
        </div>
        <div id="header_bottom">
            <div id="participants_holder">
                <div id="participants_total">
                    סה"כ השתתפו:
                    <%= game_played %>
                </div>
                <div id="participants_thumbs">
                    <% for (var c = 0; c < users_icons_count ; c++) { %>
                    <div class="img-box" style="overflow: hidden;float: right;margin-right: 5px">
                        <div style="width:32px; height:48px; overflow:hidden; " class='auto-scale' >
                            <img  src="<%=users[c].avatar.url%>" alt="<%users[c].first_name%>"/>
                        </div>
                        <span></span>
                    </div>
                    <% }%>

                </div>
            </div>
            <div id="login">
                <% include partials/user_box.ejs %>
            </div>
        </div>
    </div>
    <div id="content_wrapper">
        <div id="how_to_play">
            <h2>אז איך משחקים במשחק הזה בעצם</h2>
            מדרגים ציטוט של מועמד ומגלים לאיזה צד של המפה אנחנו שייכים</h2>
            <div id="close_button"></div>
        </div>
        <div id="quotes_holder">

            <div id="quotes_counter">

                ציטוט
                <span id="current_qoute_count"> </span>
                <!--
                מתוך
                <span id="total_qoute_count"> </span>
                -->
            </div>
            <div id="goto_results">
                 <a  href="elections_game/results">
                     עבור לתוצאות
                 >></a>
            </div>

            <div id="current_quote_holder">

            </div>
        </div>
        <div id="poll_holder">
            <input class="poll_option" id="option_1" type="button" data-response="very_positive" />
            <input class="poll_option" id="option_2" type="button" data-response="positive" />
            <input class="poll_option" id="option_3" type="button" data-response="negative" />
            <input class="poll_option" id="option_4" type="button" data-response="very_negative" />
            <input class="poll_option" id="option_0" type="button" data-response="skip" />
        </div>

    </div>

    <!--
 <div id="other_buttons_holder">
     <input class="end_game"  type="button" />
     <input class="to_index"  type="button" />
 </div>
  -->
    <% include partials/ections_game_footer.ejs %>
</div>
<% include partials/includes.ejs %>
<script type="text/javascript">


    $(document).ready(function () {

        var hash= "<%=hash%>";
        var my_id = "<%=user_logged ? user._id : ''%>";
        var quotes=null;
        var current_qoute=-1;
        var played_quotes=0;

        loadQoutes();

        function loadQoutes(){
            db_functions.getQuoteGameQuotes(false,function (err, data) {
                quotes=data.objects ;
                current_qoute=-1;
                played_quotes= data.meta.played_quotes;
                if(played_quotes>20){
                    $(this).parents('#how_to_play').hide();
                }
                $("#total_qoute_count").text(data.objects.length + played_quotes ) ;
                showNextQoute();
            });
        }



        var buttons_disabled=true;
        $('.poll_option').click(function () {
                if(buttons_disabled) {
                    return;
                }  else  {
                    buttons_disabled=true;
                }
                var quote_id   =quotes[current_qoute]._id;
                var response =$(this).data('response');
                $('.quote_credit,.quote_party').slideDown();
                quotes[current_qoute].response=  response;
                $('#current_quote_photo img').attr('src',quotes[current_qoute].candidate.image_field_thumb.url);
                $('#current_quote_photo img').css('left', '-' +(($("#current_quote_photo img").width()-82)/2)+'px');

                setTimeout(showNextQoute , 3000);
                db_functions.setQuoteGameResponse(my_id, quote_id,hash, response,quotes[current_qoute].candidate._id,false,function (err, data) {

                });
                $('#how_to_play').fadeOut(800);

        });


        function showNextQoute() {
            current_qoute++;
            if (current_qoute==quotes.length) {
                loadQoutes();
                return ;
            }
            if(current_qoute+1 + played_quotes > 25 ){
                    $('#goto_results').show();
            }
            $('#preload_img').attr('src',quotes[current_qoute].candidate.image_field_thumb.url);
            $("#current_qoute_count").text(current_qoute+1 + played_quotes)  ;
            dust.render('quote', quotes[current_qoute], function (err, out) {
                $('#current_quote_holder').html(out);
                $('.quote_credit,.quote_party').hide().removeClass('hide');
                $('#current_quote_holder').show();
                buttons_disabled=false;
            });
        }
        $('.end_game').click(function () {
            completeGame();
        });

        function completeGame() {
            window.location.href = '/elections_game/results'     ;
          //  console.log("results");
        }



        $('#close_button').click(function () {
            $(this).parents('#how_to_play').fadeOut(800);
        });

        $('#social_holder').hide();
        $('.social_icon').hide();


    } );


</script>
</body>
</html>