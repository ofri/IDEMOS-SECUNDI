<!DOCTYPE HTML>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title></title>
    <style type="text/css">
        .actions {
            display: none;
            position: absolute;
            border: 2px solid #666666;
            direction: rtl;
            float: left;
            background: white;
        }

        .actions button {
            background: #9D9D9C;
            border: 1px solid #3C3C3B;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }

        .actions ul {
            list-style-type: none;
            margin: 0;
            padding: 0;
        }

        .actions ul li {
            float: right;
        }

        .close {
            display: block;
            position: absolute;
            top: -15px;
            left: -15px;
            background: white;
            width: 20px;
            height: 20px;
            border: 2px solid #3C3C3B;
            text-align: center;
            border-radius: 20px;
            color: #3C3C3B;
            cursor: pointer;
        }

        .clear {
            clear: both;
        }

        textarea {
            width: 100%;
            height: 300px;
            resize: none;
        }
    </style>

    <script src="resources/js/jquery-1.7.1.min.js" type="text/javascript"></script>
    <script src="/resources/js/jquery-fieldselection.js" type="text/javascript"></script>
    <script type="text/javascript">
        var range;

        String.prototype.trim = function () {
            var str = this.replace(/^\s\s*/, ''),
                    ws = /\s/,
                    i = str.length;
            while (ws.test(str.charAt(--i)));
            return str.slice(0, i + 1);
        };

        $(function(){
            var mouseDown, mouseUp, top, left;
            $('.content')
                    .on('mousedown', function(e) {
                        mouseDown = e;
                    })
                    .on('mouseup', function(e){
                        mouseUp = e;

                        left = Math.ceil((mouseDown.clientX + mouseUp.clientX) / 2 - ($(".actions").width() / 2));
                        top = Math.min(mouseDown.clientY, mouseUp.clientY) - $(".actions").height() - 20;

                    }).on('keydown', function(e){
                        console.log(e.keyCode == 27);
                        if(!(e.shiftKey && (e.keyCode <=40 && e.keyCode >=37) || (e.ctrlKey && e.keyCode == 65))) e.preventDefault();
                    }).on('dragstart', function(e){
                        e.preventDefault();
                    });

            $('.actions .close').on('click', function(){
                $('.actions').hide();
            });

            $('.actions').on('focus', function(e){
                e.preventDefault();
            });

            $("#content").select(function(){
                range = $(this).getSelection();

                $(".actions")
                        .css({ top: top + 20, left: left, opacity: 0 })
                        .show()
                        .animate({ top: '-=20px', opacity: 1 }, 100, 'linear');

                console.log(range);
            });

            $("button.reply, button.suggest").on("click", function(e){
                e.preventDefault();

                if($(this).hasClass("reply")){
                    $("textarea#reply").val('"' + range.text +'"');
                }

                if($(this).hasClass("suggest")){

                }
            })
        });

    </script>
</head>
<body>

<div class="content">
    <textarea id="content">
        Lorem ipsum dolor sit amet, labitur legimus per an, vis audiam aperiri eu, ad graeci voluptua posidonium sed. Vis an illud aliquid. Eu aeterno necessitatibus nam, labore nostro eos in, ei mutat ceteros deterruisset sit. His ei habeo sensibus. Pri sensibus inimicus abhorreant no. Ne sea inermis sapientem tincidunt.

        Mel modus bonorum laboramus cu, ex solum falli regione vis. Et omnes populo definitionem mei, sanctus docendi pro id. Homero urbanitas id eam. An nec viderer partiendo hendrerit. Dicit facilisi abhorreant pro ex, te vix amet doctus admodum.

        Platonem perpetua rationibus pri ex, pri fuisset lobortis prodesset in. Usu ornatus corrumpit id, duo choro melius alterum ea. His sapientem gloriatur omittantur an, cu vix dicta theophrastus, ornatus recusabo erroribus in vix. At est porro iudico.

        Ei cum nulla tibique constituto, ut vis essent perpetua philosophia. Eu nam quod iudico, ei eos tamquam veritus. Ius ad diam primis. Et aliquid admodum quo. Quo ea quidam apeirian.

        Epicuri omnesque an ius, vel erat dictas electram eu. Usu no nihil civibus deterruisset, habeo copiosae rationibus sed an, solum atqui persequeris nec ad. Affert volutpat in eum. Vim bonorum fabulas tractatos ea, id eum fugit novum menandri, possim feugait mea ea.
    </textarea>

</div>

<textarea name="reply" id="reply" cols="30" rows="10">
</textarea>


<div class="actions">
    <span class="close">X</span>

    <ul>
        <li><button class="reply">הגב</button></li>
        <li> <button class="suggest">הצע הצעה לשינוי</button></li>
    </ul>

    <div class="clear"></div>
</div>
</body>
</html>